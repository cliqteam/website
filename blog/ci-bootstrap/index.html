<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Bootstrapping Our 12 Factor App with GitHub Actions, Docker Compose, and Digital Ocean - Cliq</title>
<meta name=description content="I love the problem solving that comes along with programming applications. But I also love the problem solving required to deploy and scale those applications. For the past 10 years of my life, I have invested immense amounts of time into not only learning how to program but how to administer Linux machines and deploy applications onto those machines. My perfectionism has not allowed me to stick with conventional methods and I have only begun to scratch the surface of cloud applications and technologies such as CI/CD, containers, container orchestration, and about a 100 other topics I have to learn about.">
<meta name=author content="Cliq"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Cliq","url":"https:\/\/cliqteam.github.io\/blog\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/cliqteam.github.io\/blog\/"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/cliqteam.github.io\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/cliqteam.github.io\/blog\/blog\/ci-bootstrap\/","name":"Bootstrapping our 12 factor app with git hub actions, docker compose, and digital ocean"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Jack Polk"},"headline":"Bootstrapping Our 12 Factor App with GitHub Actions, Docker Compose, and Digital Ocean","description":"I love the problem solving that comes along with programming applications. But I also love the problem solving required to deploy and scale those applications. For the past 10 years of my life, I have invested immense amounts of time into not only learning how to program but how to administer Linux machines and deploy applications onto those machines. My perfectionism has not allowed me to stick with conventional methods and I have only begun to scratch the surface of cloud applications and technologies such as CI\/CD, containers, container orchestration, and about a 100 other topics I have to learn about.","inLanguage":"en","wordCount":1836,"datePublished":"2021-08-02T00:00:00","dateModified":"2021-08-02T00:00:00","image":"https:\/\/cliqteam.github.io\/blog\/","keywords":["devlog, ci, 12factor"],"mainEntityOfPage":"https:\/\/cliqteam.github.io\/blog\/blog\/ci-bootstrap\/","publisher":{"@type":"Organization","name":"https:\/\/cliqteam.github.io\/blog\/","logo":{"@type":"ImageObject","url":"https:\/\/cliqteam.github.io\/blog\/","height":60,"width":60}}}</script>
<meta property="og:title" content="Bootstrapping Our 12 Factor App with GitHub Actions, Docker Compose, and Digital Ocean">
<meta property="og:description" content="I love the problem solving that comes along with programming applications. But I also love the problem solving required to deploy and scale those applications. For the past 10 years of my life, I have invested immense amounts of time into not only learning how to program but how to administer Linux machines and deploy applications onto those machines. My perfectionism has not allowed me to stick with conventional methods and I have only begun to scratch the surface of cloud applications and technologies such as CI/CD, containers, container orchestration, and about a 100 other topics I have to learn about.">
<meta property="og:url" content="https://cliqteam.github.io/blog/blog/ci-bootstrap/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Cliq">
<meta name=twitter:title content="Bootstrapping Our 12 Factor App with GitHub Actions, Docker Compose, …">
<meta name=twitter:description content="I love the problem solving that comes along with programming applications. But I also love the problem solving required to deploy and scale those applications. For the past 10 years of my life, I have …">
<meta name=twitter:card content="summary">
<meta name=generator content="Hugo 0.86.1">
<link rel=alternate href=https://cliqteam.github.io/blog/index.xml type=application/rss+xml title=Cliq><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://cliqteam.github.io/blog/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://cliqteam.github.io/blog/css/syntax.css><link rel=stylesheet href=https://cliqteam.github.io/blog/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://cliqteam.github.io/blog/>Cliq</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
</ul>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=blog-heading>
<h1>Bootstrapping Our 12 Factor App with GitHub Actions, Docker Compose, and Digital Ocean</h1>
<hr class=small>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<p>I love the problem solving that comes along with programming applications. But I
also love the problem solving required to deploy and scale those applications.
For the past 10 years of my life, I have invested immense amounts of time into
not only learning how to program but how to administer Linux machines and deploy
applications onto those machines. My perfectionism has not allowed me to stick
with conventional methods and I have only begun to scratch the surface of cloud
applications and technologies such as CI/CD, containers, container
orchestration, and about a 100 other topics I have to learn about.</p>
<p>The when2meet application for me is a perfect place to start applying the skills
I have learned up to this point in a productive but safe manner. Wouldn&rsquo;t want
to start working on mission critical services at Google without getting my feet
wet first ;)</p>
<h2 id=what-is-a-12-factor-app>What is a 12 Factor App?</h2>
<p>As put by the <a href=https://12factor.net/>12 factor app specification</a>:</p>
<blockquote>
<p>In the modern era, software is commonly delivered as a service: called web apps, or software-as-a-service. The twelve-factor app is a methodology for building software-as-a-service apps that:</p>
<ul>
<li>Use declarative formats for setup automation, to minimize time and cost for new developers joining the project;</li>
<li>Have a clean contract with the underlying operating system, offering maximum portability between execution environments;</li>
<li>Are suitable for deployment on modern cloud platforms, obviating the need for servers and systems administration;</li>
<li>Minimize divergence between development and production, enabling continuous deployment for maximum agility;</li>
<li>And can scale up without significant changes to tooling, architecture, or development practices.</li>
</ul>
<p>The twelve-factor methodology can be applied to apps written in any
programming language, and which use any combination of backing services
(database, queue, memory cache, etc).</p>
</blockquote>
<p>This standard acts as a guideline for most if not all of the design decisions
that were made while constructing the structure of this application.</p>
<h2 id=project-structure-and-requirements>Project Structure and Requirements</h2>
<p>The project, as of the time of writing, is structured in the following manner:</p>
<pre><code class=language-tree data-lang=tree>├── backend
│   ├── api
│   │   └── ...
│   ├── config
│   │   └── ...
│   ├── core
│   │   └── ...
│   ├── manage.py
│   ├── requirements.txt
│   └── run_tests.sh
├── docker
│   ├── backend
│   │   ├── dev.sh
│   │   ├── Dockerfile.local
│   │   ├── Dockerfile.prod
│   │   ├── entrypoint.sh
│   │   ├── prod.sh
│   │   └── test.sh
│   └── frontend
│       ├── Dockerfile.local
│       └── Dockerfile.prod
├── docker-compose.yaml
├── frontend
│   ├── ...
│   ├── package.json
│   ├── package-lock.json
│   ├── public
│   │   └── ...
│   └── src
│       └── ...
├── README.md
└── TODO.md
</code></pre><p>The <strong>backend</strong> folder is a Django application primarily constructed around the
<a href=https://www.django-rest-framework.org/>Django REST Framework</a>. We love Python
and we also love Django, as they let us get to making the app rather than
worrying about implementation details that are often better left to people more
invested in doing it right once and maintaining that over time.</p>
<p>The <strong>frontend</strong> folder is a Vue app. Nothing particularly interesting here
other than that Vue applications are <em>miles</em> ahead of the frontend capabilities
of Django templates (nice as they may have been 10 years ago).</p>
<p>The <strong>docker</strong> folder is a space for Docker images and their related resources.
We currently use <code>Dockerfile.local</code> for local images that are primarily for
dependency isolation and all our code is mounted with volumes to containers to
allow for rapid development that would be severly hindered by needing to rebuild
images. <code>Dockerfile.prod</code> uses multi-stage builds and planned layering to reduce image
size and complexity. This is used in our staging and production environments.</p>
<p>Our <strong>docker-compose.yaml</strong> is defined and optimized around local use. We have
another that is externally defined for our production and staging environments
that is very close but utilizes production images for optimizations not found in
development.</p>
<h2 id=docker-and-docker-compose>Docker and Docker Compose</h2>
<p>Using containers was a given for following 12-factor app standards. Using Docker
was also a given due to its popularity and amazing feature set.
<a href=https://podman.io/>Podman</a> was also considered but Docker is just so widely
supported and easy to use for our developers.</p>
<p>Docker Compose was also a given due to the amount of configuration and
environment setup that it can accomplish efficiently and quickly in a single
file! We configure our proxy, application configuration, ports, volumes, etc. in
this one file and use a similar one in our staging environment for simplicity
and consistency.</p>
<p>The following is an example of what our compose file looks like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3&#34;</span>

<span style=color:#f92672>services</span>:
  <span style=color:#f92672>backend</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/cliqteam/when2meet-backend:local</span>
    <span style=color:#f92672>build</span>:
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>./docker/backend/Dockerfile.local</span>

    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
    <span style=color:#f92672>command</span>: <span style=color:#ae81ff>/dev.sh</span>
    <span style=color:#f92672>depends_on</span>:
      - <span style=color:#ae81ff>postgres</span>
    <span style=color:#f92672>labels</span>:
      - <span style=color:#e6db74>&#34;traefik.enable=true&#34;</span>
      - <span style=color:#e6db74>&#34;traefik.http.routers.backend.rule=Host(`localhost`) &amp;&amp; (PathPrefix(`/api`) || PathPrefix(`/static`))&#34;</span>
      - <span style=color:#e6db74>&#34;traefik.http.routers.backend.entrypoints=web&#34;</span>
      - <span style=color:#e6db74>&#34;traefik.http.middlewares.xForwardedProto.headers.customrequestheaders.X-Forwarded-Proto=https&#34;</span>
      - <span style=color:#e6db74>&#34;traefik.http.routers.backend.middlewares=xForwardedProto&#34;</span>

    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>./backend:/app</span>
    <span style=color:#f92672>environment</span>:
      - <span style=color:#ae81ff>SECRET_KEY=${SECRET_KEY}</span>
      - <span style=color:#ae81ff>RECAPTCHA_SECRET_KEY=${RECAPTCHA_SECRET_KEY}</span>
      - <span style=color:#ae81ff>RECAPTCHA_SITE_KEY=${RECAPTCHA_SITE_KEY}</span>
      - <span style=color:#ae81ff>SQL_USER={{REDACTED}}</span>
      - <span style=color:#ae81ff>SQL_PASSWORD={{REDACTED}}</span>
      - <span style=color:#ae81ff>SQL_DATABASE={{REDACTED}}</span>
      - <span style=color:#ae81ff>SQL_HOST=postgres</span>
      - <span style=color:#ae81ff>SQL_PORT=5432</span>

  <span style=color:#f92672>frontend</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/cliqteam/when2meet-frontend:local</span>
    <span style=color:#f92672>build</span>:
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>./docker/frontend/Dockerfile.local</span>

    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
    <span style=color:#f92672>tty</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>labels</span>:
      - <span style=color:#e6db74>&#34;traefik.enable=true&#34;</span>
      - <span style=color:#e6db74>&#34;traefik.http.routers.frontend.rule=Host(`localhost`) &amp;&amp; PathPrefix(`/`)&#34;</span>
      - <span style=color:#e6db74>&#34;traefik.http.routers.frontend.entrypoints=web&#34;</span>
    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>./frontend:/app</span>
      - <span style=color:#ae81ff>/app/node_modules</span>

  <span style=color:#f92672>ingress</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>traefik:v2.4</span>

    <span style=color:#75715e># Enables the web UI and tells Traefik to listen to docker</span>
    <span style=color:#f92672>command</span>:
      - <span style=color:#e6db74>&#34;--api.insecure=true&#34;</span>
      - <span style=color:#e6db74>&#34;--providers.docker&#34;</span>
      - <span style=color:#e6db74>&#34;--providers.docker.exposedbydefault=false&#34;</span>
      - <span style=color:#e6db74>&#34;--entrypoints.web.address=:8000&#34;</span>
    <span style=color:#f92672>depends_on</span>:
      - <span style=color:#ae81ff>backend</span>
      - <span style=color:#ae81ff>frontend</span>

    <span style=color:#f92672>ports</span>:
      <span style=color:#75715e># The HTTP port</span>
      - <span style=color:#e6db74>&#34;8000:8000&#34;</span>
      <span style=color:#75715e># The Web UI (enabled by --api.insecure=true)</span>
      - <span style=color:#e6db74>&#34;8080:8080&#34;</span>
    <span style=color:#f92672>volumes</span>:
      <span style=color:#75715e># So that Traefik can listen to the Docker events</span>
      - <span style=color:#ae81ff>/var/run/docker.sock:/var/run/docker.sock</span>

  <span style=color:#f92672>postgres</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:12.3-alpine</span>

    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
    <span style=color:#f92672>logging</span>:
      <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>none</span>

    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>postgres-data:/var/lib/postgresql/data</span>
    <span style=color:#f92672>environment</span>:
      - <span style=color:#ae81ff>POSTGRES_USER={{REDACTED}}</span>
      - <span style=color:#ae81ff>POSTGRES_PASSWORD={{REDACTED}}</span>
      - <span style=color:#ae81ff>POSTGRES_DB={{REDACTED}}</span>

<span style=color:#f92672>volumes</span>:
  <span style=color:#f92672>postgres-data</span>:
</code></pre></div><p>What&rsquo;s nice about the use of Traefik for our ingress proxy is that configuration
can be defined per container and it removes the need for potentially complex and
arguably more clunky file-based configuration.</p>
<h2 id=github-actions>GitHub Actions</h2>
<p>While I am very partial to <a href=https://concourse-ci.org/>Concourse CI</a> and it was
what introduced me to CI concepts to begin with, <a href=https://docs.github.com/en/actions>GitHub
Actions</a> was the go-to for us given that we
use GitHub for code versioning and project management. We setup three main
workflows that capture the core of the kind of continuous integration that we
need.</p>
<p>Frontend and backend testing and building is done with the same
<code>docker-compose.yaml</code> that is used by our developers, maintaining environment
consistency and simplifying the workflow itself by abstracting the processes of
environment setup to the Dockerfile. Why repeat the steps of installing
dependencies and preparing the environment when Docker is already doing that?
Both of these workflows roughly follow this template:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>backend</span>

<span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>paths</span>:
      - <span style=color:#ae81ff>docker/backend/**</span>
      - <span style=color:#ae81ff>backend/**</span>
  <span style=color:#f92672>workflow_dispatch</span>:

<span style=color:#f92672>env</span>:
  <span style=color:#f92672>REGISTRY</span>: <span style=color:#ae81ff>ghcr.io</span>
  <span style=color:#f92672>COMPOSE_FILE</span>: <span style=color:#ae81ff>docker-compose.yaml</span>
  <span style=color:#f92672>IMAGE_NAME</span>: <span style=color:#ae81ff>cliqteam/when2meet-backend</span>
  <span style=color:#f92672>IMAGE_DOCKERFILE</span>: <span style=color:#ae81ff>docker/backend/Dockerfile.prod</span>

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>testing</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>

    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Checkout code</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Log in to the Container registry</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>registry</span>: <span style=color:#ae81ff>${{ env.REGISTRY }}</span>
          <span style=color:#f92672>username</span>: <span style=color:#ae81ff>${{ github.actor }}</span>
          <span style=color:#f92672>password</span>: <span style=color:#ae81ff>${{ {{REDACTED}} }}</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set up Docker Buildx</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/setup-buildx-action@v1</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build docker images</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>docker-compose build backend</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Run tests</span>
        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>          docker-compose run \
</span><span style=color:#e6db74>            --rm \
</span><span style=color:#e6db74>            -e APP_DOMAIN=localhost \
</span><span style=color:#e6db74>            -e SECRET_KEY=${{ {{REDACTED}} }} \
</span><span style=color:#e6db74>            -e RECAPTCHA_SECRET_KEY=${{ {{REDACTED}} }} \
</span><span style=color:#e6db74>            -e RECAPTCHA_SITE_KEY=${{ {{REDACTED}} }} \
</span><span style=color:#e6db74>            backend /test.sh</span>          

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Extract metadata (tags, labels) for Docker</span>
        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>meta</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>images</span>: <span style=color:#ae81ff>${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build and push Docker image</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>file</span>: <span style=color:#ae81ff>${{ env.IMAGE_DOCKERFILE }}</span>
          <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
          <span style=color:#f92672>push</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>tags</span>: <span style=color:#ae81ff>${{ steps.meta.outputs.tags }}</span>
          <span style=color:#f92672>labels</span>: <span style=color:#ae81ff>${{ steps.meta.outputs.labels }}</span>
          <span style=color:#f92672>cache-from</span>: <span style=color:#ae81ff>type=gha</span>
          <span style=color:#f92672>cache-to</span>: <span style=color:#ae81ff>type=gha,mode=max</span>
</code></pre></div><p>Rather than building a binary and deploying that as a release to GitHub, we
utilize Docker images for a similar purpose. Many web applications, especially
those written in Python, PHP, etc. (interpreted languages) are not single
binaries but rather a collection of source files sat behind a CGI server. Docker
images allow us to make a &ldquo;pseudo-binary&rdquo; of sorts which can be distributed to
one or more servers.</p>
<p>Our staging environment is continuously deployed also using an actions workflow.
This uses images built by the previous workflow:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy to Staging</span>

<span style=color:#f92672>on</span>:
  <span style=color:#f92672>workflow_run</span>:
    <span style=color:#f92672>workflows</span>: [<span style=color:#e6db74>&#34;backend&#34;</span>, <span style=color:#e6db74>&#34;frontend&#34;</span>]
    <span style=color:#f92672>branches</span>: [<span style=color:#ae81ff>staging]</span>
    <span style=color:#f92672>types</span>:
      - <span style=color:#ae81ff>completed</span>
  <span style=color:#f92672>workflow_dispatch</span>:

<span style=color:#f92672>env</span>:
  <span style=color:#f92672>REGISTRY</span>: <span style=color:#ae81ff>ghcr.io</span>
  <span style=color:#f92672>COMPOSE_ROOT</span>: <span style=color:#ae81ff>/srv/when2meet/compose</span>

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>deploy</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
    <span style=color:#f92672>permissions</span>:
      <span style=color:#f92672>packages</span>: <span style=color:#ae81ff>read</span>

    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Pull images and start services on staging server</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>garygrossgarten/github-action-ssh@release</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>            echo &#34;${{ secrets.GITHUB_TOKEN }}&#34; | docker login ghcr.io -u ${{ github.actor }} --password-stdin
</span><span style=color:#e6db74>            cd ${{ env.COMPOSE_ROOT }}
</span><span style=color:#e6db74>            docker-compose down
</span><span style=color:#e6db74>            docker-compose pull
</span><span style=color:#e6db74>            docker-compose up -d || exit 1</span>            
          <span style=color:#f92672>host</span>: <span style=color:#ae81ff>${{ {{REDACTED}} }}</span>
          <span style=color:#f92672>username</span>: <span style=color:#ae81ff>root</span>
          <span style=color:#f92672>privateKey</span>: <span style=color:#ae81ff>${{ {{REDACTED}} }}</span>
</code></pre></div><h2 id=deployment-digital-ocean-and-ansible>Deployment (Digital Ocean and Ansible)</h2>
<p>The last thing I&rsquo;d want is to get nice and cozy with a cloud provider and let
them do all the hard work of deploying my application for me. I&rsquo;m a programmer
for God&rsquo;s sake! Let me figure it out myself!</p>
<p>In all seriousness, the problem of vendor lock-in is a very real one and one
that we would like to avoid for reasons that range from financial to practical.
The ability to switch providers if we want/need to or to even host our
applications on our own infrastructure not only tickles my libertarian bone but
gives us independence as developers to deploy our app as we see fit.</p>
<p>For our cloud provider, we decided to go with <strong>Digital Ocean</strong>. I personally
love them due to their fair prices, reliability (my personal Droplet has an
uptime of over 1 year!), and simplicity. We didn&rsquo;t go crazy and spin up a
Kubernetes cluster (yet ;)) but instead bought a small Droplet and installed
Ubuntu 20.04 on it with Docker. We use compose as the container orchestrator and
images are pulled from our GitHub actions runner, with credentials wiped once
the runner has done its job.</p>
<p>For configuration management and server provisioning, we went with <strong>Ansible</strong>.
I&rsquo;ve been using Ansible for over a year and its a pleasure to use due to its
simplicity and vast feature set that can do in five minutes what would take you
thirty! We apply base configuration like setting the time zone, adding SSH keys,
and setting firewall rules before deploying the application itself. Application
deployment consists of copying a production version of our <code>docker-compose.yaml</code>
and creating some skeleton directories and files that will be initialized and
maintained by our GitHub Actions workflows.</p>
<h2 id=conclusion>Conclusion</h2>
<p>This is an exciting time for our team. The app is just getting of its feet and
it feels even better to have a strong foundation to build it on. Being able to
push your code and see green check marks is very reassuring and having those
changes automatically deployed gives my poor sysadmin hands a break from all the
typing. I hope to hone and improve this projects CI/CD and code structure over
time and carry this on into our future projects. One change that was recommended
to me by a collegue before even initializing the repository was splitting the
backend and frontend into seperate repos. This seemed excessive to me at the
time but as more and more complexity build in the app I&rsquo;ve started to see the
potential benefits.</p>
<p>In any case, we&rsquo;ll see where this project goes and when it is complete how
effective these strategies were at facilitating agile software development!</p>
<p>Questions or comments? <a href=mailto:cliq@myusc.net>Send an email to us</a> and let us
know if you have a product idea or comments about an existing product.</p>
<div class=blog-tags>
<a href=https://cliqteam.github.io/blog//tags/devlog/>devlog</a>&nbsp;
<a href=https://cliqteam.github.io/blog//tags/ci/>ci</a>&nbsp;
<a href=https://cliqteam.github.io/blog//tags/12factor/>12factor</a>&nbsp;
</div>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://cliqteam.github.io/blog/blog/firstpost/ data-toggle=tooltip data-placement=top title="Be a Dreamer">&larr; Previous Post</a>
</li>
</ul>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=https://github.com/cliqteam title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
<a href=https://cliqteam.github.io/blog/>Cliq</a>
&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://cliqteam.github.io/blog/>Cliq</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.86.1</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
</p>
</div>
</div>
</div>
</footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://cliqteam.github.io/blog/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://cliqteam.github.io/blog/js/load-photoswipe.js></script>
</body>
</html>